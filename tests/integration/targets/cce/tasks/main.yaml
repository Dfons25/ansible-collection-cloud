---
# author: @tischrei
- module_defaults:
    opentelekom.cloud.cce_cluster_node:
      cloud: "{{ test_cloud }}"

  block:
    - name: Set random prefix
      set_fact:
        # prefix: "{{ 99999999 | random | to_uuid | hash('md5') }}"
        prefix: 'tinotest'
  
    - name: Set initial facts
      set_fact:
        cce_node_name: "{{ ( prefix + 'ccenode') }}"

    - name: Create CCE cluster node
      cce_cluster_node:
        annotations:
          annotation1: 'abc'
        availability_zone: 'eu-de-02'
        cluster: '7ca53d10-2a70-11eb-9ade-0255ac1017a0'
        count: 1
        data_volumes:
          - SATA: 150
          - SAS: 100
        flavor: 's2.large.2'
        k8s_tags:
          testtag: 'value'                    
        keypair: 'tischrei-pub'
        labels:
          mein: 'label'
        max_pods: 16
        name: "{{ cce_node_name }}"
        os: 'CentOS 7.7'
        root_volume_size: 40
        root_volume_type:  SATA
        tags:
          - key: 'hellokey1'
            value: 'hellovalue1'
          - key: 'hellokey2'
            value: 'hellovalue2'
        wait: false
      register: node
    
    #- name: Drop CCE cluster node
    #  cce_cluster_node:
    #    name: "{{ cce_node_name }}"
    #    cluster: '7ca53d10-2a70-11eb-9ade-0255ac1017a0'
    #    state: absent
    #  register: node