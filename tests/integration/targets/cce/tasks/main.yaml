---
# author: @tischrei
- module_defaults:
    opentelekom.cloud.cce_cluster_node:
      cloud: "{{ test_cloud }}"

  block:
    - name: Set random prefix
      set_fact:
        # prefix: "{{ 99999999 | random | to_uuid | hash('md5') }}"
        prefix: 'tinotest'
  
    - name: Set initial facts
      set_fact:
        cce_node_name: "{{ ( prefix + 'ccenode') }}"

    - name: Create CCE cluster node
      cce_cluster_node:
        az: 'eu-de-02'
        cluster: '7ca53d10-2a70-11eb-9ade-0255ac1017a0'
        count: 2
        data_volumes:
          - SAS: 100
          - SATA: 100
        description: 'my-node'
        flavor: 's2.large.2'
        keypair: 'tischrei-pub'
        name: "{{ cce_node_name }}"
        root_volume_size: 40
        root_volume_type:  SATA
        wait: false
      register: node
